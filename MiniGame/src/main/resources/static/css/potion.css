/* Pixel-art medieval workshop layout */
:root {
    --scale: 3; /* 화면 배율 */
    --scene-w: calc(320px * var(--scale));
    --scene-h: calc(180px * var(--scale));
}

* { box-sizing: border-box; }

/* 게임 화면 안에서만 적용되도록 수정 */
.viewport {
    display: grid;
    place-items: center;
    /* height: 100%;  <-- 전체 화면 강제 높이 제거 (헤더/푸터와 어울리게) */
    background: #1b1e24; /* 배경색 추가 */
    padding: 20px;
}

.scene {
    position: relative;
    width: var(--scene-w);
    height: var(--scene-h);
    outline: 2px solid #39414f;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    overflow: hidden;
    margin: 0 auto; /* 중앙 정렬 */
}

/* Background tiling - 경로 수정됨 (앞에 / 추가) */
.bg {
    position: absolute;
    left: 0; top: 0; right: 0; bottom: 0;
    background-size: calc(16px * var(--scale)) calc(16px * var(--scale));
    image-rendering: pixelated;
}
.bg-wall {
    /* ★ 수정: 경로 앞에 / 붙임 */
    background-image: url('/assets/wall_tile.png');
    transform: translateY(0);
}
.bg-floor {
    /* ★ 수정: 경로 앞에 / 붙임 */
    background-image: url('/assets/floor_tile.png');
    height: calc(60px * var(--scale));
    top: auto;
    bottom: 0;
}

/* Objects */
.layer {
    position: absolute;
    image-rendering: pixelated;
}
.layer img {
    width: auto;
    height: auto;
    image-rendering: pixelated;
    transform: scale(var(--scale));
    transform-origin: top left;
}

/* Positions */
.shelf {
    /* 오른쪽으로 이동 (전체 320 기준 220 지점) */
    left: calc(220px * var(--scale));
    /* 수직 중앙 부근으로 내려옴 (전체 180 기준 60 지점) */
    top: calc(60px * var(--scale));
}
.cauldron {
    left: calc(128px * var(--scale));
    top: calc(84px * var(--scale));
}
.mortar {
    left: calc(240px * var(--scale));
    top: calc(110px * var(--scale));
}
.mortar .pestle {
    position: absolute;
    left: calc(24px * var(--scale));
    top: calc(-8px * var(--scale));
    transform-origin: top left;
    transform: scale(var(--scale)) rotate(-20deg);
}

.hud {
    position: absolute;
    left: 0; right: 0;
    top: 6px;
    text-align: center;
    font-size: 14px;
    letter-spacing: 1px;
    color: #cbd5e1;
    text-shadow: 0 2px 0 #111;
    user-select: none;
}

/* Responsive */
@media (max-width: 800px) {
    :root { --scale: 2; }
}
@media (max-width: 480px) {
    :root { --scale: 1.5; }
}

/* --- Game UI overlay --- */
.ui { position:absolute; inset:0; pointer-events:none; }

.panel {
    position:absolute; background:rgba(0,0,0,0.6); /* 배경 조금 더 진하게 */
    border:1px solid #374151; border-radius:6px;
    padding:8px 10px; pointer-events:auto; backdrop-filter: blur(2px);
    color:#e5e7eb; font-size:12px;
}
.panel .title { font-weight:700; font-size:13px; margin-bottom:6px; color:#cbd5e1; }
.panel .subtitle, .sub { margin-top:6px; color:#9ca3af; font-size:12px; }

.btn { background:#64748b; color:#fff; border:none; padding:6px 10px; border-radius:4px; cursor:pointer; font-weight:600; }
.btn:hover { filter: brightness(1.05); }
.btn:disabled { opacity:0.5; cursor:not-allowed; }
.btn.subtle { background:#374151; }

/* ★ 수정: 주문서(Order) 위치 변경 */
/* 기존: left 8px, top 8px -> 선반과 겹침 */
/* 변경: left 8px, bottom 100px -> 선반 아래쪽으로 이동 */
.order {
    left: 8px;
    top: 8px; /* 다시 위로 붙임 */
    /* bottom: 90px;  <-- 이 줄은 삭제하거나 주석 처리 */
    width: 180px;
}
.order .potion-row { display:flex; gap:6px; flex-wrap:wrap; }
.order .recipe { margin-top:6px; }

.added { right: 8px; top: 8px; width: 180px; }
.added .list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:4px; max-height:120px; overflow:auto; }
.added .list li { display:grid; grid-template-columns:auto 1fr auto auto auto auto; align-items:center; gap:6px; background:rgba(0,0,0,0.25); padding:4px; border-radius:4px; }

.swatch { width:10px; height:10px; border:1px solid #111; display:inline-block; }
.name { color:#cbd5e1; }
.qty { color:#e5e7eb; }
.mini { background:#475569; color:#fff; border:none; padding:2px 6px; border-radius:4px; cursor:pointer; }

.cook { left: 8px; bottom: 8px; right: 8px; display:flex; flex-direction:column; gap:6px; }
.bar { position:relative; height:12px; background:#111827; border:1px solid #374151; border-radius:999px; overflow:hidden; }
.bar .ok { position:absolute; top:0; bottom:0; left:30%; width:20%; background:rgba(34,197,94,0.35); }
.bar .tick { position:absolute; top:-2px; width:2px; height:16px; background:#f43f5e; left:0%; }
.ctrls { display:flex; gap:6px; flex-wrap:wrap; }
.hint { opacity:0; transition:opacity .2s; color:#e5e7eb; }
.hint.show { opacity:1; }

/* Herbs on shelf */
.herb-layer { position:absolute; left:0; top:0; }
.herb { position:absolute; width: calc(8px * var(--scale)); height: calc(8px * var(--scale)); border: 2px solid #1f2937; box-shadow: inset 0 0 0 2px rgba(255,255,255,0.25); cursor:grab; z-index: 10; }
.herb:active { cursor:grabbing; }

/* Powder in mortar */
.layer.mortar { pointer-events:auto; }
.powder { position:absolute; left: calc(22px * var(--scale)); top: calc(8px * var(--scale)); width: calc(12px * var(--scale)); height: calc(6px * var(--scale)); border-radius: 50% / 60%; opacity:0; }
.powder.visible { opacity:1; }

/* Cauldron bubbles */
.layer.cauldron { pointer-events:auto; }
.bubble { position:absolute; left: calc(32px * var(--scale)); top: calc(28px * var(--scale)); width: calc(6px * var(--scale)); height: calc(6px * var(--scale)); border-radius:999px; opacity:0.8; }

/* Modal */
.modal { position:absolute; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0.45); pointer-events:auto; z-index: 100; }
.modal.hidden { display:none; }
.modal .box { width: 70%; max-width: 520px; background:#0b1220; border:1px solid #334155; border-radius:8px; padding:12px 16px; }
.modal .row { margin-top: 10px; display:flex; gap:8px; justify-content:flex-end; }
.modal .grade { font-size:32px; font-weight:800; }
.modal .grade.g-S { color:#34d399; }
.modal .grade.g-A { color:#60a5fa; }
.modal .grade.g-B { color:#f59e0b; }
.modal .grade.g-C { color:#f43f5e; }
.modal .score { margin:6px 0; font-size:18px; }
.modal .bul { margin: 0 0 6px 18px; }

@media (max-width: 800px) {
    .order, .added { width: 40%; }
    .modal .box { width: 90%; }
}

/* =========================================
   결과창(Modal) 수정: 스크롤바 & 하얀 글씨 (최종)
   ========================================= */

/* 1. 결과창 박스: 전체 틀 */
.modal .box {
    max-height: 80vh;       /* 화면 높이의 80%를 넘지 않도록 제한 */
    display: flex;          /* 내부 요소들을 유연하게 배치 */
    flex-direction: column; /* 위에서 아래로 쌓기 */
    color: #ffffff;         /* 글씨 하얀색 */
    padding-bottom: 0;      /* 하단 여백 제거 (버튼 패널이 처리) */
}

/* 2. 결과창 내용물(Body): 여기가 스크롤 되어야 함 */
.modal .body {
    flex: 1;                /* 남는 공간을 모두 차지함 */
    padding-right: 5px;     /* 스크롤바와 글씨 사이 간격 */
    min-height: 0;          /* 플렉스박스 스크롤 버그 방지용 */
}

/* 3. 소제목들 (레시피, 내 투입 등) */
.modal .sub {
    color: #ffffff;
    font-weight: bold;
    margin-top: 15px;
    font-size: 14px;
    flex-shrink: 0;         /* 스크롤 될 때 찌그러짐 방지 */
}

/* 4. 리스트 아이템 글씨 색상 */
.modal ul.bul li {
    color: #e5e7eb;
    margin-bottom: 4px;
}

/* 5. 버튼 영역 고정 */
.modal .row {
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #334155; /* 버튼 위 구분선 추가 (선택사항) */
    flex-shrink: 0;         /* 버튼이 눌려서 안 보이게 되는 것 방지 */
    margin-bottom: 12px;
}
